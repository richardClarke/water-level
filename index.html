<!doctype html>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css">
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js"></script>
<script src="/socket.io/socket.io.js"></script>

<div class="container">
    <br>
    <p id='server-time'></p>
    <div class="jumbotron">
        <h1 class="display-5">Send Water Level</h1>
        <br>
        <input id="level" class="form-control" placeholder="level">
        <br>
        <button id="send" class="btn btn-success">Send</button>
    </div>
    <div class="display-6">Old Water Levels</div>
    <div id="messages">

    </div>
</div>
<script>
    var socket = io()

    $(() => {
        $("#send").click(()=>{
            var currentDate = new Date();
            console.log(currentDate);
            var message = {level: $("#level").val(), date:currentDate};
            console.log(message);
            postMessage(message);
        })
        getMessages();
    })

    socket.on('message', addMessage)
    
     var el = document.getElementById('server-time');

      socket.on('time', function(timeString) {
        el.innerHTML = 'Server time: ' + timeString;
      });

    function addMessage(message){
        $("#messages").append(`<h4> ${message.level} </h4>`)
    }

    function getMessages() { 
        //$.get('http://localhost:3000/messages', (data) =>{
        $.get('https://waterlevel001.herokuapp.com/messages', (data) =>{
            data.forEach(addMessage);
        })
    }

    function postMessage(message) {
        $.post('https://waterlevel001.herokuapp.com/messages', message);
        //$.post('http://localhost:3000/messages', message);
    }
</script>