<!doctype html>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css">
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js"></script>
<script src="scripts/socket.io.js"></script>

<div class="container">
    <br>
    <div class="jumbotron">
        <h1 class="display-5">Send Water Level</h1>
        <br>
        <input id="level" class="form-control" placeholder="level">
        <br>
        <button id="send" class="btn btn-success">Send</button>
    </div>
    <div class="display-6">Old Water Levels</div>
    <div id="messages">

    </div>
</div>
<script>
    var socket = io()

    $(() => {
        $("#send").click(()=>{
            var currentDate = new Date();
            console.log(currentDate);
            var message = {level: $("#level").val(), date:currentDate};
            console.log(message);
            postMessage(message);
        })
        getMessages();
    })

    socket.on('message', addMessage)

    function addMessage(message){
        $("#messages").append(`<h4> ${message.level} </h4>`)
    }

    function getMessages() {
        $.get('https://waterlevel001.herokuapp.com/messages', (data) =>{
           // data.forEach(element => {
               //addMessage(element) 
            //});
            // slim lined version of the above forEach
            data.forEach(addMessage);
        })
    }

    function postMessage(message) {
        $.post('https://waterlevel001.herokuapp.com/messages', message);
    }
</script>